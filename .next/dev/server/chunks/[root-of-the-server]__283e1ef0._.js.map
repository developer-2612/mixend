{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\n\nconst dbConfig = {\n  host: process.env.DB_HOST || 'localhost',\n  user: process.env.DB_USER || 'admin',\n  password: process.env.DB_PASSWORD || 'root',\n  database: process.env.DB_NAME || 'client_handle',\n  port: Number(process.env.DB_PORT || 3306),\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n};\n\nlet pool;\n\nexport function getPool() {\n  if (!pool) {\n    pool = mysql.createPool(dbConfig);\n  }\n  return pool;\n}\n\nexport async function getConnection() {\n  return await getPool().getConnection();\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,WAAW;IACf,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;IACjC,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;AACd;AAEA,IAAI;AAEG,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC1B;IACA,OAAO;AACT;AAEO,eAAe;IACpB,OAAO,MAAM,UAAU,aAAa;AACtC"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/auth.js"],"sourcesContent":["import crypto from 'crypto';\nimport jwt from 'jsonwebtoken';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'algoaura-dev-secret-key-2024';\n\nexport function hashPassword(password) {\n  const salt = crypto.randomBytes(16).toString('hex');\n  const hash = crypto.scryptSync(password, salt, 64).toString('hex');\n  return `scrypt$${salt}$${hash}`;\n}\n\nexport function verifyPassword(password, storedHash) {\n  if (!storedHash) return false;\n  const parts = storedHash.split('$');\n  if (parts.length !== 3 || parts[0] !== 'scrypt') return false;\n  const salt = parts[1];\n  const hash = parts[2];\n  try {\n    const derived = crypto.scryptSync(password, salt, 64);\n    const stored = Buffer.from(hash, 'hex');\n    if (stored.length !== derived.length) return false;\n    return crypto.timingSafeEqual(stored, derived);\n  } catch (err) {\n    return false;\n  }\n}\n\nexport function signAuthToken(payload) {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: '7d' });\n}\n\nexport function verifyAuthToken(token) {\n  try {\n    return jwt.verify(token, JWT_SECRET);\n  } catch (err) {\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,aAAa,QAAQ;IACnC,MAAM,OAAO,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC;IAC7C,MAAM,OAAO,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,IAAI,QAAQ,CAAC;IAC5D,OAAO,CAAC,OAAO,EAAE,KAAK,CAAC,EAAE,MAAM;AACjC;AAEO,SAAS,eAAe,QAAQ,EAAE,UAAU;IACjD,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,IAAI,MAAM,MAAM,KAAK,KAAK,KAAK,CAAC,EAAE,KAAK,UAAU,OAAO;IACxD,MAAM,OAAO,KAAK,CAAC,EAAE;IACrB,MAAM,OAAO,KAAK,CAAC,EAAE;IACrB,IAAI;QACF,MAAM,UAAU,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM;QAClD,MAAM,SAAS,OAAO,IAAI,CAAC,MAAM;QACjC,IAAI,OAAO,MAAM,KAAK,QAAQ,MAAM,EAAE,OAAO;QAC7C,OAAO,gHAAM,CAAC,eAAe,CAAC,QAAQ;IACxC,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,SAAS,cAAc,OAAO;IACnC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,gBAAgB,KAAK;IACnC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF"}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/app/api/auth/signup/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { getConnection } from '../../../../lib/db';\nimport { hashPassword, signAuthToken } from '../../../../lib/auth';\n\nexport async function POST(request) {\n  try {\n    const body = await request.json();\n    const name = (body.name || '').trim();\n    const email = (body.email || '').trim() || null;\n    const phone = (body.phone || '').trim();\n    const password = body.password || '';\n    const desiredTier = body.admin_tier === 'super_admin' ? 'super_admin' : 'client_admin';\n\n    if (!name || !phone || !password) {\n      return NextResponse.json(\n        { error: 'Name, phone, and password are required' },\n        { status: 400 }\n      );\n    }\n\n    const connection = await getConnection();\n\n    try {\n      const [existing] = await connection.execute(\n        `SELECT id FROM admin_accounts WHERE phone = ? OR email = ? LIMIT 1`,\n        [phone, email]\n      );\n\n      if (existing.length > 0) {\n        return NextResponse.json(\n          { error: 'An account with this phone or email already exists' },\n          { status: 409 }\n        );\n      }\n\n      const [superAdmins] = await connection.execute(\n        `SELECT COUNT(*) as count FROM admin_accounts WHERE admin_tier = 'super_admin'`\n      );\n      const hasSuperAdmin = Number(superAdmins[0]?.count || 0) > 0;\n      const allowSuperSignup = process.env.ALLOW_SUPER_ADMIN_SIGNUP === 'true';\n\n      let adminTier = 'client_admin';\n      if (!hasSuperAdmin) {\n        adminTier = 'super_admin';\n      } else if (desiredTier === 'super_admin' && allowSuperSignup) {\n        adminTier = 'super_admin';\n      }\n\n      const passwordHash = hashPassword(password);\n\n      const [result] = await connection.execute(\n        `INSERT INTO admin_accounts (name, phone, email, password_hash, admin_tier, status)\n         VALUES (?, ?, ?, ?, ?, 'active')`,\n        [name, phone, email, passwordHash, adminTier]\n      );\n\n      const token = signAuthToken({\n        id: result.insertId,\n        name,\n        email,\n        phone,\n        admin_tier: adminTier,\n      });\n\n      const response = NextResponse.json({\n        user: {\n          id: result.insertId,\n          name,\n          email,\n          phone,\n          admin_tier: adminTier,\n        },\n      });\n\n      response.cookies.set({\n        name: 'auth_token',\n        value: token,\n        httpOnly: true,\n        sameSite: 'lax',\n        path: '/',\n        maxAge: 60 * 60 * 24 * 7,\n        secure: process.env.NODE_ENV === 'production',\n      });\n\n      return response;\n    } finally {\n      connection.release();\n    }\n  } catch (error) {\n    console.error('Signup error:', error);\n    return NextResponse.json(\n      { error: 'Server error: ' + error.message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,OAAO,CAAC,KAAK,IAAI,IAAI,EAAE,EAAE,IAAI;QACnC,MAAM,QAAQ,CAAC,KAAK,KAAK,IAAI,EAAE,EAAE,IAAI,MAAM;QAC3C,MAAM,QAAQ,CAAC,KAAK,KAAK,IAAI,EAAE,EAAE,IAAI;QACrC,MAAM,WAAW,KAAK,QAAQ,IAAI;QAClC,MAAM,cAAc,KAAK,UAAU,KAAK,gBAAgB,gBAAgB;QAExE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,UAAU;YAChC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyC,GAClD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,MAAM,IAAA,4HAAa;QAEtC,IAAI;YACF,MAAM,CAAC,SAAS,GAAG,MAAM,WAAW,OAAO,CACzC,CAAC,kEAAkE,CAAC,EACpE;gBAAC;gBAAO;aAAM;YAGhB,IAAI,SAAS,MAAM,GAAG,GAAG;gBACvB,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAAqD,GAC9D;oBAAE,QAAQ;gBAAI;YAElB;YAEA,MAAM,CAAC,YAAY,GAAG,MAAM,WAAW,OAAO,CAC5C,CAAC,6EAA6E,CAAC;YAEjF,MAAM,gBAAgB,OAAO,WAAW,CAAC,EAAE,EAAE,SAAS,KAAK;YAC3D,MAAM,mBAAmB,QAAQ,GAAG,CAAC,wBAAwB,KAAK;YAElE,IAAI,YAAY;YAChB,IAAI,CAAC,eAAe;gBAClB,YAAY;YACd,OAAO,IAAI,gBAAgB,iBAAiB,kBAAkB;gBAC5D,YAAY;YACd;YAEA,MAAM,eAAe,IAAA,6HAAY,EAAC;YAElC,MAAM,CAAC,OAAO,GAAG,MAAM,WAAW,OAAO,CACvC,CAAC;yCACgC,CAAC,EAClC;gBAAC;gBAAM;gBAAO;gBAAO;gBAAc;aAAU;YAG/C,MAAM,QAAQ,IAAA,8HAAa,EAAC;gBAC1B,IAAI,OAAO,QAAQ;gBACnB;gBACA;gBACA;gBACA,YAAY;YACd;YAEA,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC;gBACjC,MAAM;oBACJ,IAAI,OAAO,QAAQ;oBACnB;oBACA;oBACA;oBACA,YAAY;gBACd;YACF;YAEA,SAAS,OAAO,CAAC,GAAG,CAAC;gBACnB,MAAM;gBACN,OAAO;gBACP,UAAU;gBACV,UAAU;gBACV,MAAM;gBACN,QAAQ,KAAK,KAAK,KAAK;gBACvB,QAAQ,oDAAyB;YACnC;YAEA,OAAO;QACT,SAAU;YACR,WAAW,OAAO;QACpB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,mBAAmB,MAAM,OAAO;QAAC,GAC1C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}
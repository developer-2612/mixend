{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\n\nconst dbConfig = {\n  host: process.env.DB_HOST || 'localhost',\n  user: process.env.DB_USER || 'admin',\n  password: process.env.DB_PASSWORD || 'root',\n  database: process.env.DB_NAME || 'client_handle',\n  port: Number(process.env.DB_PORT || 3306),\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n};\n\nlet pool;\n\nexport function getPool() {\n  if (!pool) {\n    pool = mysql.createPool(dbConfig);\n  }\n  return pool;\n}\n\nexport async function getConnection() {\n  return await getPool().getConnection();\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,WAAW;IACf,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;IACjC,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;AACd;AAEA,IAAI;AAEG,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC1B;IACA,OAAO;AACT;AAEO,eAAe;IACpB,OAAO,MAAM,UAAU,aAAa;AACtC"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/auth.js"],"sourcesContent":["import crypto from 'crypto';\nimport jwt from 'jsonwebtoken';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'algoaura-dev-secret-key-2024';\n\nexport function hashPassword(password) {\n  const salt = crypto.randomBytes(16).toString('hex');\n  const hash = crypto.scryptSync(password, salt, 64).toString('hex');\n  return `scrypt$${salt}$${hash}`;\n}\n\nexport function verifyPassword(password, storedHash) {\n  if (!storedHash) return false;\n  const parts = storedHash.split('$');\n  if (parts.length !== 3 || parts[0] !== 'scrypt') return false;\n  const salt = parts[1];\n  const hash = parts[2];\n  try {\n    const derived = crypto.scryptSync(password, salt, 64);\n    const stored = Buffer.from(hash, 'hex');\n    if (stored.length !== derived.length) return false;\n    return crypto.timingSafeEqual(stored, derived);\n  } catch (err) {\n    return false;\n  }\n}\n\nexport function signAuthToken(payload) {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: '7d' });\n}\n\nexport function verifyAuthToken(token) {\n  try {\n    return jwt.verify(token, JWT_SECRET);\n  } catch (err) {\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,aAAa,QAAQ;IACnC,MAAM,OAAO,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC;IAC7C,MAAM,OAAO,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,IAAI,QAAQ,CAAC;IAC5D,OAAO,CAAC,OAAO,EAAE,KAAK,CAAC,EAAE,MAAM;AACjC;AAEO,SAAS,eAAe,QAAQ,EAAE,UAAU;IACjD,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,IAAI,MAAM,MAAM,KAAK,KAAK,KAAK,CAAC,EAAE,KAAK,UAAU,OAAO;IACxD,MAAM,OAAO,KAAK,CAAC,EAAE;IACrB,MAAM,OAAO,KAAK,CAAC,EAAE;IACrB,IAAI;QACF,MAAM,UAAU,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM;QAClD,MAAM,SAAS,OAAO,IAAI,CAAC,MAAM;QACjC,IAAI,OAAO,MAAM,KAAK,QAAQ,MAAM,EAAE,OAAO;QAC7C,OAAO,gHAAM,CAAC,eAAe,CAAC,QAAQ;IACxC,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,SAAS,cAAc,OAAO;IACnC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,gBAAgB,KAAK;IACnC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF"}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/app/api/auth/login/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { getConnection } from '../../../../lib/db';\nimport { signAuthToken, verifyPassword } from '../../../../lib/auth';\n\nexport async function POST(request) {\n  try {\n    const { email, password } = await request.json();\n    const identifier = (email || '').trim();\n    const identifierLower = identifier.toLowerCase();\n    const phoneDigits = identifier.replace(/\\D/g, '');\n\n    if (!identifier || !password) {\n      return NextResponse.json(\n        { error: 'Email or phone and password are required' },\n        { status: 400 }\n      );\n    }\n\n    const connection = await getConnection();\n\n    try {\n      const idValue = Number.isFinite(Number(identifier)) ? Number(identifier) : -1;\n      const phoneCandidates = Array.from(\n        new Set([identifier, phoneDigits].filter(Boolean))\n      );\n      const phoneClause = phoneCandidates.length\n        ? ` OR phone IN (${phoneCandidates.map(() => '?').join(', ')})`\n        : '';\n\n      const [users] = await connection.execute(\n        `SELECT id, name, email, phone, password_hash, admin_tier, status\n         FROM admin_accounts\n         WHERE LOWER(email) = ?${phoneClause} OR id = ?\n         LIMIT 1`,\n        [identifierLower, ...phoneCandidates, idValue]\n      );\n\n      if (!users || users.length === 0) {\n        return NextResponse.json(\n          { error: 'Invalid email or password' },\n          { status: 401 }\n        );\n      }\n\n      const user = users[0];\n      if (user.status !== 'active') {\n        return NextResponse.json(\n          { error: 'Account is inactive' },\n          { status: 403 }\n        );\n      }\n\n      const isValid = verifyPassword(password, user.password_hash);\n      if (!isValid) {\n        return NextResponse.json(\n          { error: 'Invalid email or password' },\n          { status: 401 }\n        );\n      }\n\n      const token = signAuthToken({\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        phone: user.phone,\n        admin_tier: user.admin_tier,\n      });\n\n      const response = NextResponse.json({\n        user: {\n          id: user.id,\n          name: user.name,\n          email: user.email,\n          phone: user.phone,\n          admin_tier: user.admin_tier,\n        },\n      });\n\n      response.cookies.set({\n        name: 'auth_token',\n        value: token,\n        httpOnly: true,\n        sameSite: 'lax',\n        path: '/',\n        maxAge: 60 * 60 * 24 * 7,\n        secure: process.env.NODE_ENV === 'production',\n      });\n\n      return response;\n    } finally {\n      connection.release();\n    }\n  } catch (error) {\n    console.error('Login error:', error);\n    return NextResponse.json(\n      { error: 'Server error: ' + error.message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAC9C,MAAM,aAAa,CAAC,SAAS,EAAE,EAAE,IAAI;QACrC,MAAM,kBAAkB,WAAW,WAAW;QAC9C,MAAM,cAAc,WAAW,OAAO,CAAC,OAAO;QAE9C,IAAI,CAAC,cAAc,CAAC,UAAU;YAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2C,GACpD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,MAAM,IAAA,4HAAa;QAEtC,IAAI;YACF,MAAM,UAAU,OAAO,QAAQ,CAAC,OAAO,eAAe,OAAO,cAAc,CAAC;YAC5E,MAAM,kBAAkB,MAAM,IAAI,CAChC,IAAI,IAAI;gBAAC;gBAAY;aAAY,CAAC,MAAM,CAAC;YAE3C,MAAM,cAAc,gBAAgB,MAAM,GACtC,CAAC,cAAc,EAAE,gBAAgB,GAAG,CAAC,IAAM,KAAK,IAAI,CAAC,MAAM,CAAC,CAAC,GAC7D;YAEJ,MAAM,CAAC,MAAM,GAAG,MAAM,WAAW,OAAO,CACtC,CAAC;;+BAEsB,EAAE,YAAY;gBAC7B,CAAC,EACT;gBAAC;mBAAoB;gBAAiB;aAAQ;YAGhD,IAAI,CAAC,SAAS,MAAM,MAAM,KAAK,GAAG;gBAChC,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAA4B,GACrC;oBAAE,QAAQ;gBAAI;YAElB;YAEA,MAAM,OAAO,KAAK,CAAC,EAAE;YACrB,IAAI,KAAK,MAAM,KAAK,UAAU;gBAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAAsB,GAC/B;oBAAE,QAAQ;gBAAI;YAElB;YAEA,MAAM,UAAU,IAAA,+HAAc,EAAC,UAAU,KAAK,aAAa;YAC3D,IAAI,CAAC,SAAS;gBACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAA4B,GACrC;oBAAE,QAAQ;gBAAI;YAElB;YAEA,MAAM,QAAQ,IAAA,8HAAa,EAAC;gBAC1B,IAAI,KAAK,EAAE;gBACX,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK;gBACjB,OAAO,KAAK,KAAK;gBACjB,YAAY,KAAK,UAAU;YAC7B;YAEA,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC;gBACjC,MAAM;oBACJ,IAAI,KAAK,EAAE;oBACX,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,KAAK;oBACjB,OAAO,KAAK,KAAK;oBACjB,YAAY,KAAK,UAAU;gBAC7B;YACF;YAEA,SAAS,OAAO,CAAC,GAAG,CAAC;gBACnB,MAAM;gBACN,OAAO;gBACP,UAAU;gBACV,UAAU;gBACV,MAAM;gBACN,QAAQ,KAAK,KAAK,KAAK;gBACvB,QAAQ,oDAAyB;YACnC;YAEA,OAAO;QACT,SAAU;YACR,WAAW,OAAO;QACpB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,mBAAmB,MAAM,OAAO;QAAC,GAC1C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}
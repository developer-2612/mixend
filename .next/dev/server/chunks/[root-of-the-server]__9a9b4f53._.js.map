{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\n\nconst dbConfig = {\n  host: process.env.DB_HOST || 'localhost',\n  user: process.env.DB_USER || 'admin',\n  password: process.env.DB_PASSWORD || 'root',\n  database: process.env.DB_NAME || 'client_handle',\n  port: Number(process.env.DB_PORT || 3306),\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n};\n\nlet pool;\n\nexport function getPool() {\n  if (!pool) {\n    pool = mysql.createPool(dbConfig);\n  }\n  return pool;\n}\n\nexport async function getConnection() {\n  return await getPool().getConnection();\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,WAAW;IACf,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;IACjC,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;AACd;AAEA,IAAI;AAEG,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC1B;IACA,OAAO;AACT;AAEO,eAAe;IACpB,OAAO,MAAM,UAAU,aAAa;AACtC"}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/db-helpers.js"],"sourcesContent":["import { getConnection } from \"./db\";\n\n// Get all users with their admin info\nexport async function getAllUsers() {\n  const connection = await getConnection();\n  try {\n    const [users] = await connection.query(`\n      SELECT u.*, a.name as admin_name \n      FROM users u \n      LEFT JOIN admin_accounts a ON u.assigned_admin_id = a.id\n      ORDER BY u.created_at DESC\n    `);\n    return users;\n  } finally {\n    connection.release();\n  }\n}\n\n// Get user by ID\nexport async function getUserById(userId) {\n  const connection = await getConnection();\n  try {\n    const [user] = await connection.query(`\n      SELECT u.*, a.name as admin_name \n      FROM users u \n      LEFT JOIN admin_accounts a ON u.assigned_admin_id = a.id\n      WHERE u.id = ?\n    `, [userId]);\n    return user[0];\n  } finally {\n    connection.release();\n  }\n}\n\n// Get all messages with user and admin details\nexport async function getAllMessages() {\n  const connection = await getConnection();\n  try {\n    const [messages] = await connection.query(`\n      SELECT m.*, u.name as user_name, u.phone, a.name as admin_name \n      FROM messages m \n      LEFT JOIN users u ON m.user_id = u.id \n      LEFT JOIN admin_accounts a ON m.admin_id = a.id\n      ORDER BY m.created_at DESC\n    `);\n    return messages;\n  } finally {\n    connection.release();\n  }\n}\n\n// Get messages for a specific user\nexport async function getMessagesForUser(userId) {\n  const connection = await getConnection();\n  try {\n    const [messages] = await connection.query(`\n      SELECT m.*, u.name as user_name, a.name as admin_name \n      FROM messages m \n      LEFT JOIN users u ON m.user_id = u.id \n      LEFT JOIN admin_accounts a ON m.admin_id = a.id\n      WHERE m.user_id = ?\n      ORDER BY m.created_at DESC\n    `, [userId]);\n    return messages;\n  } finally {\n    connection.release();\n  }\n}\n\n// Get all requirements with user info\nexport async function getAllRequirements() {\n  const connection = await getConnection();\n  try {\n    const [requirements] = await connection.query(`\n      SELECT r.*, u.name, u.phone \n      FROM user_requirements r \n      LEFT JOIN users u ON r.user_id = u.id\n      ORDER BY r.created_at DESC\n    `);\n    return requirements;\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function updateRequirementStatus(requirementId, status) {\n  const connection = await getConnection();\n  try {\n    await connection.query(\n      `UPDATE user_requirements SET status = ? WHERE id = ?`,\n      [status, requirementId]\n    );\n    const [rows] = await connection.query(\n      `SELECT r.*, u.name, u.phone \n       FROM user_requirements r \n       LEFT JOIN users u ON r.user_id = u.id\n       WHERE r.id = ?\n       LIMIT 1`,\n      [requirementId]\n    );\n    return rows[0] || null;\n  } finally {\n    connection.release();\n  }\n}\n\n// Get all needs with user and admin info\nexport async function getAllNeeds() {\n  const connection = await getConnection();\n  try {\n    const [needs] = await connection.query(`\n      SELECT n.*, u.name, u.phone, a.name as assigned_admin_name \n      FROM user_needs n \n      LEFT JOIN users u ON n.user_id = u.id \n      LEFT JOIN admin_accounts a ON n.assigned_to = a.id\n      ORDER BY n.created_at DESC\n    `);\n    return needs;\n  } finally {\n    connection.release();\n  }\n}\n\n// Add new user\nexport async function addUser(phone, name, email, assigned_admin_id) {\n  const connection = await getConnection();\n  try {\n    const [result] = await connection.query(`\n      INSERT INTO users (phone, name, email, assigned_admin_id) \n      VALUES (?, ?, ?, ?)\n    `, [phone, name, email, assigned_admin_id]);\n    return result.insertId;\n  } finally {\n    connection.release();\n  }\n}\n\n// Add new message\nexport async function addMessage(user_id, admin_id, message_text, message_type) {\n  const connection = await getConnection();\n  try {\n    const [result] = await connection.query(`\n      INSERT INTO messages (user_id, admin_id, message_text, message_type, status) \n      VALUES (?, ?, ?, ?, 'sent')\n    `, [user_id, admin_id, message_text, message_type]);\n    return result.insertId;\n  } finally {\n    connection.release();\n  }\n}\n\n// Get dashboard stats\nexport async function getDashboardStats() {\n  const connection = await getConnection();\n  try {\n    const [stats] = await connection.query(`\n      SELECT \n        (SELECT COUNT(*) FROM users) as total_users,\n        (SELECT COUNT(*) FROM messages WHERE message_type = 'incoming') as incoming_messages,\n        (SELECT COUNT(*) FROM user_requirements WHERE status = 'in_progress') as active_requirements,\n        (SELECT COUNT(*) FROM user_needs WHERE status = 'open') as open_needs\n    `);\n    return stats[0];\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getAdminById(adminId) {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(\n      `SELECT id, name, email, phone, admin_tier, status, created_at, updated_at\n       FROM admin_accounts\n       WHERE id = ?\n       LIMIT 1`,\n      [adminId]\n    );\n    return rows[0] || null;\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function updateAdminProfile(adminId, { name, email }) {\n  const connection = await getConnection();\n  try {\n    const updates = [];\n    const values = [];\n    if (typeof name === 'string') {\n      updates.push('name = ?');\n      values.push(name.trim());\n    }\n    if (typeof email === 'string') {\n      updates.push('email = ?');\n      values.push(email.trim() || null);\n    }\n    if (updates.length === 0) {\n      return await getAdminById(adminId);\n    }\n    values.push(adminId);\n    await connection.query(\n      `UPDATE admin_accounts SET ${updates.join(', ')} WHERE id = ?`,\n      values\n    );\n    return await getAdminById(adminId);\n  } finally {\n    connection.release();\n  }\n}\n\nfunction parseTemplateVariables(value) {\n  if (!value) return [];\n  try {\n    const parsed = JSON.parse(value);\n    return Array.isArray(parsed) ? parsed : [];\n  } catch (err) {\n    return [];\n  }\n}\n\nexport async function getAllBroadcasts() {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(`\n      SELECT b.*, a.name as created_by_name\n      FROM broadcasts b\n      LEFT JOIN admin_accounts a ON b.created_by = a.id\n      ORDER BY b.created_at DESC\n    `);\n    return rows;\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getBroadcastById(broadcastId) {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(\n      `SELECT b.*, a.name as created_by_name\n       FROM broadcasts b\n       LEFT JOIN admin_accounts a ON b.created_by = a.id\n       WHERE b.id = ?\n       LIMIT 1`,\n      [broadcastId]\n    );\n    return rows[0] || null;\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function createBroadcast({\n  title,\n  message,\n  targetAudienceType,\n  scheduledAt,\n  status,\n  createdBy,\n}) {\n  const connection = await getConnection();\n  try {\n    const [result] = await connection.query(\n      `INSERT INTO broadcasts\n       (title, message, target_audience_type, scheduled_at, status, created_by)\n       VALUES (?, ?, ?, ?, ?, ?)`,\n      [\n        title,\n        message,\n        targetAudienceType || 'all',\n        scheduledAt || null,\n        status || 'draft',\n        createdBy || null,\n      ]\n    );\n    return await getBroadcastById(result.insertId);\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getAllTemplates() {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(`\n      SELECT t.*, a.name as created_by_name\n      FROM message_templates t\n      LEFT JOIN admin_accounts a ON t.created_by = a.id\n      ORDER BY t.created_at DESC\n    `);\n    return rows.map((row) => ({\n      ...row,\n      variables: parseTemplateVariables(row.variables_json),\n    }));\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getTemplateById(templateId) {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(\n      `SELECT t.*, a.name as created_by_name\n       FROM message_templates t\n       LEFT JOIN admin_accounts a ON t.created_by = a.id\n       WHERE t.id = ?\n       LIMIT 1`,\n      [templateId]\n    );\n    const row = rows[0];\n    if (!row) return null;\n    return { ...row, variables: parseTemplateVariables(row.variables_json) };\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function createTemplate({ name, category, content, variables, createdBy }) {\n  const connection = await getConnection();\n  try {\n    const variablesJson = Array.isArray(variables) ? JSON.stringify(variables) : null;\n    const [result] = await connection.query(\n      `INSERT INTO message_templates (name, category, content, variables_json, created_by)\n       VALUES (?, ?, ?, ?, ?)`,\n      [name, category, content, variablesJson, createdBy || null]\n    );\n    return await getTemplateById(result.insertId);\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getTeamMembers() {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(`\n      SELECT\n        a.id,\n        a.name,\n        a.email,\n        a.admin_tier,\n        a.status,\n        SUM(CASE WHEN m.message_type = 'outgoing' THEN 1 ELSE 0 END) AS messages_sent,\n        COUNT(DISTINCT CASE\n          WHEN m.created_at >= (NOW() - INTERVAL 7 DAY) THEN m.user_id\n          ELSE NULL\n        END) AS active_chats\n      FROM admin_accounts a\n      LEFT JOIN messages m ON m.admin_id = a.id\n      GROUP BY a.id\n      ORDER BY a.created_at DESC\n    `);\n    return rows;\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getReportOverview(startDate) {\n  const connection = await getConnection();\n  try {\n    const [messageStats] = await connection.query(\n      `\n        SELECT DATE(created_at) as date, COUNT(*) as count\n        FROM messages\n        WHERE created_at >= ?\n        GROUP BY DATE(created_at)\n        ORDER BY DATE(created_at)\n      `,\n      [startDate]\n    );\n\n    const [leadStats] = await connection.query(\n      `\n        SELECT status, COUNT(*) as count\n        FROM user_requirements\n        GROUP BY status\n      `\n    );\n\n    const [agentPerformance] = await connection.query(`\n      SELECT\n        a.id,\n        a.name,\n        a.admin_tier,\n        a.status,\n        SUM(CASE WHEN m.message_type = 'outgoing' THEN 1 ELSE 0 END) AS messages_sent,\n        COUNT(DISTINCT CASE\n          WHEN m.created_at >= (NOW() - INTERVAL 7 DAY) THEN m.user_id\n          ELSE NULL\n        END) AS active_chats\n      FROM admin_accounts a\n      LEFT JOIN messages m ON m.admin_id = a.id\n      GROUP BY a.id\n      ORDER BY a.created_at DESC\n    `);\n\n    const [topCampaigns] = await connection.query(`\n      SELECT id, title, status, sent_count, delivered_count, created_at\n      FROM broadcasts\n      ORDER BY sent_count DESC, created_at DESC\n      LIMIT 5\n    `);\n\n    return {\n      messageStats,\n      leadStats,\n      agentPerformance,\n      topCampaigns,\n      revenueSources: [],\n    };\n  } finally {\n    connection.release();\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 580, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/auth.js"],"sourcesContent":["import crypto from 'crypto';\nimport jwt from 'jsonwebtoken';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'algoaura-dev-secret-key-2024';\n\nexport function hashPassword(password) {\n  const salt = crypto.randomBytes(16).toString('hex');\n  const hash = crypto.scryptSync(password, salt, 64).toString('hex');\n  return `scrypt$${salt}$${hash}`;\n}\n\nexport function verifyPassword(password, storedHash) {\n  if (!storedHash) return false;\n  const parts = storedHash.split('$');\n  if (parts.length !== 3 || parts[0] !== 'scrypt') return false;\n  const salt = parts[1];\n  const hash = parts[2];\n  try {\n    const derived = crypto.scryptSync(password, salt, 64);\n    const stored = Buffer.from(hash, 'hex');\n    if (stored.length !== derived.length) return false;\n    return crypto.timingSafeEqual(stored, derived);\n  } catch (err) {\n    return false;\n  }\n}\n\nexport function signAuthToken(payload) {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: '7d' });\n}\n\nexport function verifyAuthToken(token) {\n  try {\n    return jwt.verify(token, JWT_SECRET);\n  } catch (err) {\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,aAAa,QAAQ;IACnC,MAAM,OAAO,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC;IAC7C,MAAM,OAAO,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,IAAI,QAAQ,CAAC;IAC5D,OAAO,CAAC,OAAO,EAAE,KAAK,CAAC,EAAE,MAAM;AACjC;AAEO,SAAS,eAAe,QAAQ,EAAE,UAAU;IACjD,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,IAAI,MAAM,MAAM,KAAK,KAAK,KAAK,CAAC,EAAE,KAAK,UAAU,OAAO;IACxD,MAAM,OAAO,KAAK,CAAC,EAAE;IACrB,MAAM,OAAO,KAAK,CAAC,EAAE;IACrB,IAAI;QACF,MAAM,UAAU,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM;QAClD,MAAM,SAAS,OAAO,IAAI,CAAC,MAAM;QACjC,IAAI,OAAO,MAAM,KAAK,QAAQ,MAAM,EAAE,OAAO;QAC7C,OAAO,gHAAM,CAAC,eAAe,CAAC,QAAQ;IACxC,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,SAAS,cAAc,OAAO;IACnC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,gBAAgB,KAAK;IACnC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF"}},
    {"offset": {"line": 631, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/auth-server.js"],"sourcesContent":["import { cookies } from 'next/headers';\nimport { verifyAuthToken } from './auth';\n\nexport async function getAuthUser() {\n  const cookieStore = await cookies();\n  const token = cookieStore.get('auth_token')?.value;\n  if (!token) return null;\n  return verifyAuthToken(token);\n}\n\nexport async function requireAuth() {\n  const user = await getAuthUser();\n  if (!user) {\n    const error = new Error('Unauthorized');\n    error.status = 401;\n    throw error;\n  }\n  return user;\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;IAC7C,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,IAAA,gIAAe,EAAC;AACzB;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM;QACT,MAAM,QAAQ,IAAI,MAAM;QACxB,MAAM,MAAM,GAAG;QACf,MAAM;IACR;IACA,OAAO;AACT"}},
    {"offset": {"line": 660, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/app/api/dashboard/stats/route.js"],"sourcesContent":["import { getDashboardStats } from '../../../../lib/db-helpers';\nimport { requireAuth } from '../../../../lib/auth-server';\n\nexport async function GET(req) {\n  try {\n    await requireAuth();\n    const stats = await getDashboardStats();\n    return Response.json({ success: true, data: stats });\n  } catch (error) {\n    if (error.status === 401) {\n      return Response.json({ success: false, error: 'Unauthorized' }, { status: 401 });\n    }\n    return Response.json({ success: false, error: error.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,GAAG;IAC3B,IAAI;QACF,MAAM,IAAA,sIAAW;QACjB,MAAM,QAAQ,MAAM,IAAA,2IAAiB;QACrC,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAM;IACpD,EAAE,OAAO,OAAO;QACd,IAAI,MAAM,MAAM,KAAK,KAAK;YACxB,OAAO,SAAS,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QAChF;QACA,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACF"}}]
}
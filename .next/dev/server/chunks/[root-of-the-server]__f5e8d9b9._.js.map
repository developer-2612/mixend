{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/auth.js"],"sourcesContent":["import crypto from 'crypto';\nimport jwt from 'jsonwebtoken';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'algoaura-dev-secret-key-2024';\n\nexport function hashPassword(password) {\n  const salt = crypto.randomBytes(16).toString('hex');\n  const hash = crypto.scryptSync(password, salt, 64).toString('hex');\n  return `scrypt$${salt}$${hash}`;\n}\n\nexport function verifyPassword(password, storedHash) {\n  if (!storedHash) return false;\n  const parts = storedHash.split('$');\n  if (parts.length !== 3 || parts[0] !== 'scrypt') return false;\n  const salt = parts[1];\n  const hash = parts[2];\n  try {\n    const derived = crypto.scryptSync(password, salt, 64);\n    const stored = Buffer.from(hash, 'hex');\n    if (stored.length !== derived.length) return false;\n    return crypto.timingSafeEqual(stored, derived);\n  } catch (err) {\n    return false;\n  }\n}\n\nexport function signAuthToken(payload) {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: '7d' });\n}\n\nexport function verifyAuthToken(token) {\n  try {\n    return jwt.verify(token, JWT_SECRET);\n  } catch (err) {\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,aAAa,QAAQ;IACnC,MAAM,OAAO,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC;IAC7C,MAAM,OAAO,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,IAAI,QAAQ,CAAC;IAC5D,OAAO,CAAC,OAAO,EAAE,KAAK,CAAC,EAAE,MAAM;AACjC;AAEO,SAAS,eAAe,QAAQ,EAAE,UAAU;IACjD,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,IAAI,MAAM,MAAM,KAAK,KAAK,KAAK,CAAC,EAAE,KAAK,UAAU,OAAO;IACxD,MAAM,OAAO,KAAK,CAAC,EAAE;IACrB,MAAM,OAAO,KAAK,CAAC,EAAE;IACrB,IAAI;QACF,MAAM,UAAU,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM;QAClD,MAAM,SAAS,OAAO,IAAI,CAAC,MAAM;QACjC,IAAI,OAAO,MAAM,KAAK,QAAQ,MAAM,EAAE,OAAO;QAC7C,OAAO,gHAAM,CAAC,eAAe,CAAC,QAAQ;IACxC,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,SAAS,cAAc,OAAO;IACnC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,gBAAgB,KAAK;IACnC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF"}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/auth-server.js"],"sourcesContent":["import { cookies } from 'next/headers';\nimport { verifyAuthToken } from './auth';\n\nexport async function getAuthUser() {\n  const cookieStore = await cookies();\n  const token = cookieStore.get('auth_token')?.value;\n  if (!token) return null;\n  return verifyAuthToken(token);\n}\n\nexport async function requireAuth() {\n  const user = await getAuthUser();\n  if (!user) {\n    const error = new Error('Unauthorized');\n    error.status = 401;\n    throw error;\n  }\n  return user;\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;IAC7C,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,IAAA,gIAAe,EAAC;AACzB;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM;QACT,MAAM,QAAQ,IAAI,MAAM;QACxB,MAAM,MAAM,GAAG;QACf,MAAM;IACR;IACA,OAAO;AACT"}},
    {"offset": {"line": 198, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\n\nconst dbConfig = {\n  host: process.env.DB_HOST || 'localhost',\n  user: process.env.DB_USER || 'admin',\n  password: process.env.DB_PASSWORD || 'root',\n  database: process.env.DB_NAME || 'client_handle',\n  port: Number(process.env.DB_PORT || 3306),\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n};\n\nlet pool;\n\nexport function getPool() {\n  if (!pool) {\n    pool = mysql.createPool(dbConfig);\n  }\n  return pool;\n}\n\nexport async function getConnection() {\n  return await getPool().getConnection();\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,WAAW;IACf,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;IACjC,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;AACd;AAEA,IAAI;AAEG,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC1B;IACA,OAAO;AACT;AAEO,eAAe;IACpB,OAAO,MAAM,UAAU,aAAa;AACtC"}},
    {"offset": {"line": 230, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/app/api/profile/password/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { requireAuth } from '../../../../lib/auth-server';\nimport { getConnection } from '../../../../lib/db';\nimport { hashPassword, verifyPassword } from '../../../../lib/auth';\n\nexport async function POST(request) {\n  try {\n    const user = await requireAuth();\n    const body = await request.json();\n    const currentPassword = String(body?.currentPassword || '');\n    const newPassword = String(body?.newPassword || '');\n\n    if (!newPassword || newPassword.length < 8) {\n      return NextResponse.json(\n        { success: false, error: 'New password must be at least 8 characters.' },\n        { status: 400 }\n      );\n    }\n\n    const connection = await getConnection();\n    try {\n      const [rows] = await connection.execute(\n        `SELECT password_hash FROM admin_accounts WHERE id = ? LIMIT 1`,\n        [user.id]\n      );\n\n      if (!rows || rows.length === 0) {\n        const response = NextResponse.json(\n          { success: false, error: 'User not found' },\n          { status: 401 }\n        );\n        response.cookies.set({\n          name: 'auth_token',\n          value: '',\n          httpOnly: true,\n          sameSite: 'lax',\n          path: '/',\n          maxAge: 0,\n          secure: process.env.NODE_ENV === 'production',\n        });\n        return response;\n      }\n\n      const storedHash = rows[0]?.password_hash;\n      if (storedHash) {\n        const isValid = verifyPassword(currentPassword, storedHash);\n        if (!isValid) {\n          return NextResponse.json(\n            { success: false, error: 'Current password is incorrect.' },\n            { status: 400 }\n          );\n        }\n      } else if (!currentPassword) {\n        // No password on record yet; allow setting a new one.\n      }\n\n      const passwordHash = hashPassword(newPassword);\n      await connection.execute(\n        `UPDATE admin_accounts SET password_hash = ? WHERE id = ?`,\n        [passwordHash, user.id]\n      );\n\n      return NextResponse.json({ success: true });\n    } finally {\n      connection.release();\n    }\n  } catch (error) {\n    if (error.status === 401) {\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\n    }\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,sIAAW;QAC9B,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,kBAAkB,OAAO,MAAM,mBAAmB;QACxD,MAAM,cAAc,OAAO,MAAM,eAAe;QAEhD,IAAI,CAAC,eAAe,YAAY,MAAM,GAAG,GAAG;YAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAA8C,GACvE;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,MAAM,IAAA,4HAAa;QACtC,IAAI;YACF,MAAM,CAAC,KAAK,GAAG,MAAM,WAAW,OAAO,CACrC,CAAC,6DAA6D,CAAC,EAC/D;gBAAC,KAAK,EAAE;aAAC;YAGX,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;gBAC9B,MAAM,WAAW,gJAAY,CAAC,IAAI,CAChC;oBAAE,SAAS;oBAAO,OAAO;gBAAiB,GAC1C;oBAAE,QAAQ;gBAAI;gBAEhB,SAAS,OAAO,CAAC,GAAG,CAAC;oBACnB,MAAM;oBACN,OAAO;oBACP,UAAU;oBACV,UAAU;oBACV,MAAM;oBACN,QAAQ;oBACR,QAAQ,oDAAyB;gBACnC;gBACA,OAAO;YACT;YAEA,MAAM,aAAa,IAAI,CAAC,EAAE,EAAE;YAC5B,IAAI,YAAY;gBACd,MAAM,UAAU,IAAA,+HAAc,EAAC,iBAAiB;gBAChD,IAAI,CAAC,SAAS;oBACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;wBAAE,SAAS;wBAAO,OAAO;oBAAiC,GAC1D;wBAAE,QAAQ;oBAAI;gBAElB;YACF,OAAO,IAAI,CAAC,iBAAiB;YAC3B,sDAAsD;YACxD;YAEA,MAAM,eAAe,IAAA,6HAAY,EAAC;YAClC,MAAM,WAAW,OAAO,CACtB,CAAC,wDAAwD,CAAC,EAC1D;gBAAC;gBAAc,KAAK,EAAE;aAAC;YAGzB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAK;QAC3C,SAAU;YACR,WAAW,OAAO;QACpB;IACF,EAAE,OAAO,OAAO;QACd,IAAI,MAAM,MAAM,KAAK,KAAK;YACxB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpF;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF"}}]
}